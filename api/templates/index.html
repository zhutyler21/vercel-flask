<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat with GPT-3</title>
</head>
<body>
    <div id="chatbox">
        <!-- 这里将显示对话记录 -->
    </div>
    <form action="/reply" method="post">
        <input type="hidden" id="apiKey" name="apiKey" value="">
        <input type="text" id="content" name="content" required>
        <button type="submit">Send</button>
    </form>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function() {
        var apiKey = localStorage.getItem('apiKey');
        if (!apiKey) {
            apiKey = prompt('Please enter your OpenAI API key:');
            localStorage.setItem('apiKey', apiKey);
        }
        $('#apiKey').val(apiKey);

        $('form').on('submit', function(e) {
            e.preventDefault(); // prevent page refresh
            $.ajax({
                url: '/reply',
                method: 'POST',
                data: $(this).serialize(), // this includes apiKey
                success: function(data) {
                    $('#chatbox').append('<p>You: ' + $('#content').val() + '</p>');
                    $('#chatbox').append('<p>GPT-3: ' + data.content + '</p>');
                    $('#content').val(''); // clear input box
                }
            });
        });
    });
    </script>
</body>
</html>